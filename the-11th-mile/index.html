<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The 11th Mile | Elite Training Library</title>
    <style>
        /* --- 1. MASTER DESIGN VARIABLES --- */
        :root {
            --primary: #2D3436; /* Dark Charcoal/Black */
            --accent: #55E6C1; /* Mint */
            --bg: #F8FAFB;
            --white: #FFFFFF;
            --track-red: #e74c3c;
            --warmup: #27ae60;
            --gold: #f1c40f;
        }

        * { box-sizing: border-box; }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg); 
            color: var(--primary); 
            margin: 0; 
            line-height: 1.5;
        }

        /* --- 2. HEADER --- */
        header { 
            background: var(--white); 
            padding: 50px 20px 60px 20px; 
            text-align: center; 
            border-bottom: 1px solid #eee;
            position: relative; 
        }

        .logo { font-size: 2.5rem; font-weight: 900; letter-spacing: -2px; margin: 0; line-height: 1; text-decoration: none; color: var(--primary); display:block;}
        .sub-logo { color: #636e72; text-transform: uppercase; letter-spacing: 3px; font-size: 0.8rem; margin-top: 10px; }
        
        /* ABOUT BUTTON */
        .about-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--primary);
            border: 1px solid var(--primary);
            color: var(--white);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 50;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .about-btn:hover { 
            background: var(--accent); 
            border-color: var(--accent); 
            color: var(--primary); 
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(85, 230, 193, 0.4);
        }

        /* --- 3. CONTAINERS & CALCULATOR --- */
        .container { max-width: 1000px; margin: -40px auto 50px auto; padding: 0 25px; }
        .dashboard { display: grid; grid-template-columns: 2fr 1fr; gap: 25px; }
        @media(max-width: 768px) { .dashboard { grid-template-columns: 1fr; } }

        /* PACE CALCULATOR BAR */
        .sticky-bar { 
            position: relative; 
            z-index: 1;
            background: var(--primary); color: white; padding: 20px; border-radius: 16px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); margin-bottom: 30px;
            display: flex; align-items: center; justify-content: space-between; gap: 20px; flex-wrap: wrap;
        }

        .input-group label { display: block; font-size: 0.75rem; text-transform: uppercase; opacity: 0.8; margin-bottom: 5px; }

        .calc-input {
            padding: 10px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.2); 
            background: rgba(255,255,255,0.1); color: white; font-weight: bold; width: 100px; 
            font-size: 1.1rem; text-align: center; transition: 0.3s;
        }
        .calc-input:focus { outline: none; border-color: var(--accent); background: rgba(0,0,0,0.2); }

        /* --- 4. BUTTONS --- */
        
        /* UNIT BUTTON - MILES MODE (Solid Mint, Black Text) */
        .unit-btn {
            background: var(--accent); 
            border: 2px solid var(--accent); 
            color: var(--primary); 
            padding: 8px 15px; 
            border-radius: 20px; font-size: 0.8rem; font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        .unit-btn:hover { opacity: 0.9; }
        
        /* UNIT BUTTON - KM MODE (White Bg, Mint Outline, Black Text) */
        .unit-btn.metric-mode {
            background: var(--white);
            border: 2px solid var(--accent);
            color: var(--primary); /* Black Text */
        }

        .gender-btn {
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; 
            padding: 8px 15px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; 
            cursor: pointer; transition: 0.2s; margin-left: 5px;
        }
        .gender-btn:hover { background: rgba(255,255,255,0.2); }
        .gender-btn.female { background: #e84393; border-color: #e84393; }

        .reset-btn {
            background: none; border: 1px solid rgba(255,255,255,0.3); color: rgba(255,255,255,0.7); 
            padding: 10px 15px; border-radius: 8px; cursor: pointer; font-size: 0.8rem; transition: 0.2s;
        }
        .reset-btn:hover { background: rgba(255,255,255,0.1); color: white; border-color: white; }

        /* --- 5. GRID & CARDS --- */
        .grid { 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 25px; 
            display: grid; 
        }

        .card, .session-card { 
            background: var(--white); border-radius: 16px; padding: 25px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.04); margin-bottom: 25px;
            display: block; text-decoration: none; color: inherit; transition: 0.3s;
        }
        .session-card:hover { transform: translateY(-5px); border-color: var(--accent); box-shadow: 0 10px 30px rgba(0,0,0,0.08); }

        .card-header { height: 110px; padding: 25px; display: flex; flex-direction: column; justify-content: flex-end; border-radius: 16px 16px 0 0; margin: -25px -25px 20px -25px; }
        .card h2 { margin-top: 0; font-size: 1.4rem; border-bottom: 2px solid #2c3e50; display: inline-block; padding-bottom: 5px; color: #2c3e50; }

        .engine-bg { background: linear-gradient(135deg, #2c3e50, #000); }
        .track-bg { background: linear-gradient(135deg, #c0392b, #8e44ad); }
        .plan-bg { background: linear-gradient(135deg, #11998e, #38ef7d); }

        .tag { font-size: 0.65rem; font-weight: bold; text-transform: uppercase; background: rgba(255,255,255,0.2); color: white; padding: 4px 10px; border-radius: 20px; width: fit-content; margin-bottom: 8px; backdrop-filter: blur(5px); }
        .meta-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #f0f0f0; }
        
        .difficulty { font-size: 0.7rem; font-weight: 800; color: #27ae60; letter-spacing: 0.5px; }
        
        .dist-badge { font-size: 0.75rem; font-weight: 700; color: #b2bec3; }
        .diff-text { display: block; font-size: 0.7rem; font-weight: 800; letter-spacing: 0.5px; margin-bottom: 5px; }
        .dist-text { display: block; font-size: 0.75rem; font-weight: 700; color: #b2bec3; margin-bottom: 12px; }
        .card-divider { border-bottom: 1px solid #eee; margin-bottom: 12px; }

        /* --- 6. TAB LOGIC --- */
        .tabs-container { display: flex; justify-content: center; gap: 15px; margin-bottom: 30px; flex-wrap: wrap; }
        
        .tab-btn {
            padding: 12px 25px; border-radius: 30px; border: 1px solid #eee; background: white;
            color: #636e72; font-weight: 700; font-size: 0.9rem; cursor: pointer; transition: 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }
        .tab-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .tab-btn.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 5px 15px rgba(45, 52, 54, 0.3); }

        .tab-content { display: none !important; animation: fadeIn 0.4s ease; }
        .tab-content.active { display: grid !important; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- 7. EXTRAS --- */
        .qp-box {
            background: white; padding: 10px 20px; border-radius: 8px; 
            text-align: center; border: 1px solid #eee; min-width: 110px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }
        .qp-label { display:block; font-size: 0.65rem; font-weight:800; color: #b2bec3; letter-spacing: 1px; margin-bottom: 2px; }
        .qp-val { font-weight: 900; color: var(--primary); font-size: 1.1rem; }

        @keyframes pulseBorder {
            0% { border-color: rgba(255,255,255,0.2); box-shadow: 0 0 0 0 rgba(85, 230, 193, 0.4); }
            70% { border-color: var(--accent); box-shadow: 0 0 0 5px rgba(85, 230, 193, 0); }
            100% { border-color: rgba(255,255,255,0.2); box-shadow: 0 0 0 0 rgba(85, 230, 193, 0); }
        }
        .calc-input.empty-state { animation: pulseBorder 2s infinite; }

        .footer { text-align: center; padding: 60px 20px; color: #b2bec3; font-size: 0.8rem; border-top: 1px solid #eee; margin-top: 60px;}

        /* --- 8. MODAL (POPUP) STYLES --- */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 2000; 
            left: 0; top: 0; 
            width: 100%; height: 100%; 
            background-color: rgba(0,0,0,0.6); 
            backdrop-filter: blur(5px);
            align-items: center; justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        .modal-content {
            background-color: #fff;
            padding: 40px;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            position: relative;
            text-align: left;
        }
        .close-btn {
            position: absolute;
            top: 20px; right: 20px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }
        .close-btn:hover { color: var(--primary); }
        .modal-h { margin-top: 0; color: var(--primary); font-size: 1.5rem; }
        .modal-p { font-size: 0.95rem; color: #636e72; line-height: 1.6; margin-bottom: 20px; }
        .modal-sec { margin-bottom: 15px; padding-left: 15px; border-left: 3px solid var(--accent); }
        .modal-sec strong { display: block; color: var(--primary); }
        .modal-sec small { color: #888; }

    </style>
</head>
<body>

<header>
    <button class="about-btn" onclick="toggleModal()">About</button>
    
    <h1 class="logo">THE 11th MILE</h1>
    <div class="sub-logo">Performance Laboratory // England</div>
</header>

<div class="container">
    
    <div class="sticky-bar">
        <div style="flex: 1;">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px; flex-wrap: wrap;">
                <h4 style="margin:0; margin-right: 5px;">Performance Data</h4>
                <button id="unitBtn" class="unit-btn" onclick="toggleUnits()">Display: Miles</button>
                <button id="genderBtn" class="gender-btn" onclick="toggleGender()">MALE</button>
            </div>
            
            <div style="display: flex; gap: 10px; align-items: center;">
                <span style="font-size: 0.8rem; opacity: 0.8; font-weight: bold; text-transform: uppercase;">Enter 5K Time (MM:SS)</span>
                <input type="text" id="globalPace" class="calc-input empty-state" placeholder="20:00" oninput="formatInput(this)">
            </div>
        </div>

        <div style="text-align: right; min-width: 140px;">
            <span style="font-size: 0.7rem; text-transform: uppercase; opacity: 0.6; letter-spacing: 1px;">Training Tier</span><br>
            <span id="tierLabel" style="font-weight: 900; color: var(--accent); font-size: 1.4rem;">--</span><br>
            
            <div style="font-size: 0.8rem; font-weight: bold; margin-top: 5px;">
                <span id="milePaceDisplay">-- /mi</span> 
                <span style="opacity: 0.3; margin: 0 5px;">|</span> 
                <span id="kmPaceDisplay">-- /km</span>
            </div>
            <button class="reset-btn" onclick="resetCalc()" style="margin-top: 10px; width:100%;">Clear Data</button>
        </div>
    </div>

    <div id="quickPaces" style="display:none; gap: 15px; margin-bottom: 40px; justify-content: center; flex-wrap: wrap; animation: fadeIn 0.5s ease;">
        <div class="qp-box" style="border-bottom: 3px solid #27ae60;">
            <span class="qp-label">EASY RUN</span>
            <span id="qp-easy" class="qp-val">--:--</span>
        </div>
        <div class="qp-box" style="border-bottom: 3px solid #e74c3c;">
            <span class="qp-label">TEMPO</span>
            <span id="qp-tempo" class="qp-val">--:--</span>
        </div>
        <div class="qp-box" style="border-bottom: 3px solid #3498db;">
            <span class="qp-label">LONG RUN</span>
            <span id="qp-long" class="qp-val">--:--</span>
        </div>
    </div> 

    <div class="tabs-container">
        <button class="tab-btn" onclick="switchTab('plans', this)">The Blueprints</button>
        <button class="tab-btn active" onclick="switchTab('engine', this)">The Engine Room</button>
        <button class="tab-btn" onclick="switchTab('track', this)">The Track Lab</button>
    </div>

    <div id="plans" class="grid tab-content">
        <a href="plan-21.html" class="session-card">
            <div class="card-header plan-bg">
                <span class="tag">Foundation</span>
                <h3 style="color:white; margin:0; border:none; padding:0;">21 Miles / Week</h3>
            </div>
            <div class="card-body">
                <span class="difficulty" style="display:block; margin-bottom:12px;">BEGINNER / BASE</span>
                <div class="card-divider"></div>
                <p>5 Month Schedule. Building the aerobic base.</p>
            </div>
        </a>
        <a href="plan-31.html" class="session-card">
            <div class="card-header plan-bg">
                <span class="tag">Progression</span>
                <h3 style="color:white; margin:0; border:none; padding:0;">31 Miles / Week</h3>
            </div>
            <div class="card-body">
                <span class="difficulty" style="display:block; margin-bottom:12px;">INTERMEDIATE</span>
                <div class="card-divider"></div>
                <p>5 Month Schedule. Increasing durability.</p>
            </div>
        </a>
        <a href="plan-41.html" class="session-card">
            <div class="card-header plan-bg">
                <span class="tag">Development</span>
                <h3 style="color:white; margin:0; border:none; padding:0;">41 Miles / Week</h3>
            </div>
            <div class="card-body">
                <span class="difficulty" style="display:block; margin-bottom:12px;">INTERMEDIATE +</span>
                <div class="card-divider"></div>
                <p>5 Month Schedule. Double sessions.</p>
            </div>
        </a>
        <a href="plan-51.html" class="session-card">
            <div class="card-header plan-bg">
                <span class="tag">Elite Volume</span>
                <h3 style="color:white; margin:0; border:none; padding:0;">51 Miles / Week</h3>
            </div>
            <div class="card-body">
                <span class="difficulty" style="display:block; margin-bottom:12px;">ELITE</span>
                <div class="card-divider"></div>
                <p>5 Month Schedule. Maximum aerobic development.</p>
            </div>
        </a>
    </div>

    <div id="engine" class="grid tab-content active">
        <a href="session-8.html" class="session-card">
            <div class="card-header engine-bg">
                <span class="tag" style="color: #f1c40f; background: rgba(0,0,0,0.3);">Fitness Test</span>
                <h3 style="color: white; margin: 0; border:none; padding:0;">The 5K Benchmark</h3>
            </div>
            <div class="card-body">
                <span class="diff-text" style="color: #c0392b;">MAX EFFORT</span>
                <span id="dist-s8" class="dist-text">Session Dist: ~5 Miles</span>
                <div class="card-divider"></div>
                <p id="desc-s8">3.1 Mile Time Trial // 90-95% Intensity</p>
                <small style="color: #888;">Assess fitness and set zones.</small>
            </div>
        </a>

        <a href="session-2.html" class="session-card">
            <div class="card-header engine-bg">
                <span class="tag">Pure Speed</span>
                <h3 style="color: white; margin: 0; border:none; padding:0;">Mixed Pace Strength</h3>
            </div>
            <div class="card-body">
                <span class="diff-text" style="color: #27ae60;">INTERMEDIATE / ELITE</span>
                <span id="dist-s2" class="dist-text">Session Dist: ~6 Miles</span>
                <div class="card-divider"></div>
                <p id="desc-s2">1mi Tempo // 1mi 10k // 2x0.5mi 5k // 4x0.25mi 3k</p>
                <small style="color: #888;">Multi-tiered lactate flushing.</small>
            </div>
        </a>

        <a href="session-7.html" class="session-card">
            <div class="card-header engine-bg">
                <span class="tag">The Cut-Down</span>
                <h3 style="color: white; margin: 0; border:none; padding:0;">4 Mile Progressive</h3>
            </div>
            <div class="card-body">
                <span class="diff-text" style="color: #27ae60;">INTERMEDIATE</span>
                <span id="dist-s7" class="dist-text">Session Dist: ~6 Miles</span>
                <div class="card-divider"></div>
                <p id="desc-s7">4 Miles Continuous // +10s Faster Per Mile</p>
                <small style="color: #888;">Aerobic power and discipline.</small>
            </div>
        </a>

        <a href="session-9.html" class="session-card">
            <div class="card-header engine-bg">
                <span class="tag">Speed Play</span>
                <h3 style="color: white; margin: 0; border:none; padding:0;">The Fartlek Pyramid</h3>
            </div>
            <div class="card-body">
                <span class="diff-text" style="color: #27ae60;">INTERMEDIATE</span>
                <span id="dist-s9" class="dist-text">Session Dist: ~6 Miles</span>
                <div class="card-divider"></div>
                <p>3 / 4 / 5 / 3 / 2 / 1 Minutes</p>
                <small style="color: #888;">Gear changing & aerobic power.</small>
            </div>
        </a>

        <a href="session-1.html" class="session-card">
            <div class="card-header engine-bg"> <span class="tag">The Ladder</span>
                <h3 style="color: white; margin: 0; border:none; padding:0;">Tempo + Ladder</h3>
            </div>
            <div class="card-body">
                <span class="diff-text" style="color: #27ae60;">ALL LEVELS</span>
                <span id="dist-s1" class="dist-text">Session Dist: ~6.5 Miles</span>
                <div class="card-divider"></div>
                <p id="desc-s1">1 Mile Tempo + (90s / 60s / 45s / 30s)</p>
                <small style="color: #888;">Leg turnover under fatigue.</small>
            </div>
        </a>

        <a href="session-6.html" class="session-card">
            <div class="card-header engine-bg">
                <span class="tag">Threshold Mix</span>
                <h3 style="color: white; margin: 0; border:none; padding:0;">The 4 & 7 Mix</h3>
            </div>
            <div class="card-body">
                <span class="diff-text" style="color: #27ae60;">INTERMEDIATE +</span>
                <span id="dist-s6" class="dist-text">Session Dist: ~6.5 Miles</span>
                <div class="card-divider"></div>
                <p id="desc-s6">Strides // 4 min // 7 min // 4 min // 7 min</p>
                <small style="color: #888;">Alternating intervals.</small>
            </div>
        </a>

        <a href="session-5.html" class="session-card">
            <div class="card-header engine-bg">
                <span class="tag">Progressive Mix</span>
                <h3 style="color: white; margin: 0; border:none; padding:0;">Progressive Tempo</h3>
            </div>
            <div class="card-body">
                <span class="diff-text" style="color: var(--accent);">ADVANCED</span>
                <span id="dist-s5" class="dist-text">Session Dist: ~7.5 Miles</span>
                <div class="card-divider"></div>
                <p id="desc-s5">3 Mile Tempo // 4 x 2:30min Fast</p>
                <small style="color: #888;">Running fast on fatigued legs.</small>
            </div>
        </a>
    </div>

    <div id="track" class="grid tab-content">
        <a href="session-3.html" class="session-card">
            <div class="card-header track-bg">
                <span class="tag">Track Volume</span>
                <h3 style="color: white; margin: 0; border:none; padding:0;">The Track Pyramid</h3>
            </div>
            <div class="card-body">
                <span class="diff-text" style="color: #27ae60;">ADVANCED</span>
                <span id="dist-s3" class="dist-text">Session Dist: ~5.5 Miles</span>
                <div class="card-divider"></div>
                <p>600m / 800m / 1200m / 2x800m / 3x600m</p>
                <small style="color: #888;">High volume V02 max simulation.</small>
            </div>
        </a>

        <a href="session-4.html" class="session-card">
            <div class="card-header track-bg">
                <span class="tag">Track Volume</span>
                <h3 style="color: white; margin: 0; border:none; padding:0;">Mixed Volume</h3>
            </div>
            <div class="card-body">
                <span class="diff-text" style="color: #27ae60;">ADVANCED</span>
                <span id="dist-s4" class="dist-text">Session Dist: ~6 Miles</span>
                <div class="card-divider"></div>
                <p>800m / 2x1000m / 2x800m / 3x600m</p>
                <small style="color: #888;">Descending volume aerobic strength.</small>
            </div>
        </a>
    </div>

</div>

<div id="aboutModal" class="modal" onclick="toggleModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <span class="close-btn" onclick="toggleModal()">&times;</span>
        <h2 class="modal-h">About The 11th Mile</h2>
        <p class="modal-p">Welcome to the elite training library. This tool is designed to provide high-performance running structure for athletes of all levels.</p>
        
        <div class="modal-sec">
            <strong>The Blueprints</strong>
            <small>5-month progressive schedules ranging from 21 to 51 miles per week. Use these to build your aerobic base.</small>
        </div>
        
        <div class="modal-sec">
            <strong>The Engine Room</strong>
            <small>Classic physiological sessions (Tempo, Threshold, Fartlek) designed to improve lactate threshold and endurance.</small>
        </div>
        
        <div class="modal-sec">
            <strong>The Track Lab</strong>
            <small>High-precision interval work for V02 max development and speed.</small>
        </div>
        
        <p class="modal-p" style="margin-bottom:0; font-size:0.8rem; margin-top:20px;"><em>Enter your 5K time above to calculate your exact training paces.</em></p>
    </div>
</div>

<div class="footer">
    &copy; 2025 THE 11th MILE. England. Training For Each Day Of The Week.
</div>

<script>
    // --- 1. INITIALIZATION ---
    let isMale = true; 
    let isMetric = false;

    window.onload = function() {
        // Retrieve settings
        const savedGender = localStorage.getItem('userGender');
        if (savedGender === 'FEMALE') {
            isMale = false;
            updateGenderButton();
        }

        const savedTab = localStorage.getItem('activeTab');
        if(savedTab) {
            const btn = document.querySelector(`button[onclick="switchTab('${savedTab}', this)"]`);
            if(btn) switchTab(savedTab, btn);
        } else {
            // Default to Engine Room
            switchTab('engine', document.querySelector(`button[onclick="switchTab('engine', this)"]`));
        }

        const savedTime = localStorage.getItem('user5kTime');
        if(savedTime) document.getElementById('globalPace').value = savedTime;

        // LOAD UNIT PREFERENCE CORRECTLY
        const savedUnit = localStorage.getItem('userUnit');
        if(savedUnit === 'KM') {
            isMetric = true;
        } else {
            isMetric = false;
        }
        updateUnitButtonVisuals(); // Set visual state immediately

        // Run calculation
        updatePageCalc();
    };

    // --- 2. MODAL LOGIC ---
    function toggleModal() {
        const modal = document.getElementById('aboutModal');
        if (modal.style.display === 'flex') {
            modal.style.display = 'none';
        } else {
            modal.style.display = 'flex';
        }
    }

    // --- 3. TABS LOGIC ---
    function switchTab(tabId, btn) {
        localStorage.setItem('activeTab', tabId);
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        btn.classList.add('active');
    }

    // --- 4. TOGGLE LOGIC ---
    function toggleGender() {
        isMale = !isMale;
        localStorage.setItem('userGender', isMale ? 'MALE' : 'FEMALE');
        updateGenderButton();
        updatePageCalc();
    }

    function updateGenderButton() {
        const btn = document.getElementById('genderBtn');
        if(isMale) {
            btn.innerText = "MALE";
            btn.classList.remove('female');
        } else {
            btn.innerText = "FEMALE";
            btn.classList.add('female');
        }
    }

    function toggleUnits() {
        isMetric = !isMetric;
        localStorage.setItem('userUnit', isMetric ? 'KM' : 'MILES'); // Save preference
        updateUnitButtonVisuals();
        updatePageCalc();
    }

    // Helper to update button visual state
    function updateUnitButtonVisuals() {
        const btn = document.getElementById('unitBtn');
        if(isMetric) {
            btn.innerText = "Display: KM";
            btn.classList.add('metric-mode'); // White bg, Mint border
        } else {
            btn.innerText = "Display: Miles";
            btn.classList.remove('metric-mode'); // Mint bg, Dark text
        }
    }

    // --- 5. INPUT FORMATTING ---
    function formatInput(input) {
        input.classList.remove('empty-state'); // Stop pulse
        
        let val = input.value.replace(/\D/g, ''); 
        if (val.length > 4) val = val.substring(0, 4);
        if (val.length > 2) input.value = val.slice(0, 2) + ':' + val.slice(2);
        else input.value = val;

        if(val.length >= 3) {
            localStorage.setItem('user5kTime', input.value);
        }
        
        updatePageCalc();
    }

    // --- 6. CALCULATION CORE ---
    function parseTime(input) {
        if(!input || !input.includes(':')) return 0;
        const parts = input.split(':');
        return (parseInt(parts[0]) * 60) + parseInt(parts[1]);
    }

    function formatTime(s) {
        const m = Math.floor(s / 60);
        const sec = Math.floor(s % 60);
        return m + ":" + (sec < 10 ? '0' : '') + sec;
    }

    function updatePageCalc() {
        const input = document.getElementById('globalPace').value;
        const tierLabel = document.getElementById('tierLabel');
        const mileDisplay = document.getElementById('milePaceDisplay');
        const kmDisplay = document.getElementById('kmPaceDisplay');

        const totalSeconds = parseTime(input);

        // Empty State
        if (!totalSeconds) {
            tierLabel.innerText = "--";
            tierLabel.style.color = "var(--accent)";
            mileDisplay.innerText = "-- /mi";
            kmDisplay.innerText = "-- /km";
            document.getElementById('quickPaces').style.display = 'none';
            document.getElementById('globalPace').classList.add('empty-state');
            return;
        }

        // Filled State
        document.getElementById('globalPace').classList.remove('empty-state');
        document.getElementById('quickPaces').style.display = 'flex';

        // Paces
        const pacePerMileSecs = totalSeconds / 3.1068;
        mileDisplay.innerText = formatTime(pacePerMileSecs) + " /mi";
        const pacePerKmSecs = totalSeconds / 5;
        kmDisplay.innerText = formatTime(pacePerKmSecs) + " /km";

        // Tier Logic
        let eliteCutoff = isMale ? 960 : 1080;
        let advCutoff = isMale ? 1200 : 1320;
        let intCutoff = isMale ? 1500 : 1620;

        if(totalSeconds < eliteCutoff) {
            tierLabel.innerText = "ELITE";
            tierLabel.style.color = "#f1c40f"; 
        } else if (totalSeconds < advCutoff) {
            tierLabel.innerText = "ADVANCED";
            tierLabel.style.color = "#e74c3c"; 
        } else if (totalSeconds < intCutoff) {
            tierLabel.innerText = "INTERMEDIATE";
            tierLabel.style.color = "#27ae60"; 
        } else {
            tierLabel.innerText = "DEVELOPMENT";
            tierLabel.style.color = "#636e72"; 
        }

        // Quick Paces Logic
        let easyPace, tempoPace, longPace;
        if(isMetric) {
            easyPace = (totalSeconds / 5) + 75; 
            tempoPace = (totalSeconds / 5) + 25; 
            longPace = (totalSeconds / 5) + 56; 
        } else {
            easyPace = (totalSeconds / 3.1068) + 120;
            tempoPace = (totalSeconds / 3.1068) + 40; 
            longPace = (totalSeconds / 3.1068) + 90; 
        }

        document.getElementById('qp-easy').innerText = formatTime(easyPace);
        document.getElementById('qp-tempo').innerText = formatTime(tempoPace);
        document.getElementById('qp-long').innerText = formatTime(longPace);
        
        updateDescriptions();
    }

    function resetCalc() {
        document.getElementById('globalPace').value = "";
        localStorage.removeItem('user5kTime');
        updatePageCalc();
    }

    // --- 7. DYNAMIC TEXT UPDATES ---
    function updateDescriptions() {
        const distLabel = "Session Dist: ";

        // Update all session cards based on unit preference
        if(isMetric) {
            // Blueprints
            document.getElementById('t-plan21').innerText = "34 KM / Week";
            document.getElementById('t-plan31').innerText = "50 KM / Week";
            document.getElementById('t-plan41').innerText = "66 KM / Week";
            document.getElementById('t-plan51').innerText = "82 KM / Week";

            // Sessions Distances
            document.getElementById('dist-s1').innerText = distLabel + "~10.5 KM";
            document.getElementById('dist-s2').innerText = distLabel + "~10 KM";
            document.getElementById('dist-s3').innerText = distLabel + "~9 KM";
            document.getElementById('dist-s4').innerText = distLabel + "~10 KM";
            document.getElementById('dist-s5').innerText = distLabel + "~12 KM";
            document.getElementById('dist-s6').innerText = distLabel + "~10.5 KM";
            document.getElementById('dist-s7').innerText = distLabel + "~10 KM";
            document.getElementById('dist-s8').innerText = distLabel + "~8 KM";
            document.getElementById('dist-s9').innerText = distLabel + "~10 KM";

            // Session Descriptions
            document.getElementById('desc-s2').innerText = "1.6km Tempo // 1.6km 10k // 2x800m 5k // 4x400m 3k";
            document.getElementById('desc-s1').innerText = "1.6km Tempo + (90s / 60s / 45s / 30s)";
            document.getElementById('desc-s5').innerText = "5km Tempo // 4 x 2:30min Fast";
            document.getElementById('desc-s7').innerText = "6km Continuous // +6s Faster Per KM";
            document.getElementById('desc-s8').innerText = "5 KM Time Trial // 90-95% Intensity";
        } else {
            // Blueprints
            document.getElementById('t-plan21').innerText = "21 Miles / Week";
            document.getElementById('t-plan31').innerText = "31 Miles / Week";
            document.getElementById('t-plan41').innerText = "41 Miles / Week";
            document.getElementById('t-plan51').innerText = "51 Miles / Week";

            // Sessions Distances
            document.getElementById('dist-s1').innerText = distLabel + "~6.5 Miles";
            document.getElementById('dist-s2').innerText = distLabel + "~6 Miles";
            document.getElementById('dist-s3').innerText = distLabel + "~5.5 Miles";
            document.getElementById('dist-s4').innerText = distLabel + "~6 Miles";
            document.getElementById('dist-s5').innerText = distLabel + "~7.5 Miles";
            document.getElementById('dist-s6').innerText = distLabel + "~6.5 Miles";
            document.getElementById('dist-s7').innerText = distLabel + "~6 Miles";
            document.getElementById('dist-s8').innerText = distLabel + "~5 Miles";
            document.getElementById('dist-s9').innerText = distLabel + "~6 Miles";

            // Session Descriptions
            document.getElementById('desc-s2').innerText = "1mi Tempo // 1mi 10k // 2x0.5mi 5k // 4x0.25mi 3k";
            document.getElementById('desc-s1').innerText = "1 Mile Tempo + (90s / 60s / 45s / 30s)";
            document.getElementById('desc-s5').innerText = "3 Mile Tempo // 4 x 2:30min Fast";
            document.getElementById('desc-s7').innerText = "4 Miles Continuous // +10s Faster Per Mile";
            document.getElementById('desc-s8').innerText = "3.1 Mile Time Trial // 90-95% Intensity";
        }
    }
</script>

</body>
</html>